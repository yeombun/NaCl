<!DOCTYPE html>
<html lang="ko">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>ğŸŒ¡ï¸ CM31P GitHub Native ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background: #f9f9f9; }
    h1 { color: #1976d2; }
    .container { max-width: 1200px; margin: 0 auto; }
    /* ì•Œë¦¼ ì„¹ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    #alerts { border: 1px solid #d73a49; border-radius: 6px; padding: 10px; margin: 20px 0; background: #ffdce0; text-align: left;}
    #alerts h2 { margin-top: 0; color: #d73a49; font-size: 1.2em; }
    .alert-item a { color: #d73a49; font-weight: 600; text-decoration: none; }
    .alert-item a:hover { text-decoration: underline; }
    #alert-list { padding-left: 20px; margin-bottom: 0; }
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    .cards { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .card { border: 2px solid #1976d2; border-radius: 10px; padding: 20px; width: 200px; background: white; }
    .value { font-size: 1.8em; font-weight: bold; margin-top: 10px; }
    #graphs { display: flex; justify-content: space-around; flex-wrap: wrap; }
    .graph { width: 45%; min-width: 350px; }
    .last-updated { text-align: center; margin-top: 20px; color: #586069; font-size: 12px; }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸŒ¡ï¸ CM31P GitHub Native ëŒ€ì‹œë³´ë“œ</h1>

  <div id="alerts">
    <h2>ğŸš¨ í˜„ì¬ ë°œìƒí•œ ì•Œë¦¼</h2>
    <ul id="alert-list"><li>ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li></ul>
  </div>

  <div class="cards">
    <div class="card">
      <p><b>ìµœì‹  ìˆ˜ì‹  ì‹œê°„</b></p>
      <div class="value" id="time">-</div>
    </div>
    <div class="card">
      <p><b>ìµœì‹  ë†ë„</b></p>
      <div class="value" id="conc">- %</div>
    </div>
    <div class="card">
      <p><b>ìµœì‹  ì˜¨ë„</b></p>
      <div class="value" id="temp">- Â°C</div>
    </div>
  </div>

  <div id="graphs">
    <div id="concGraph" class="graph"></div>
    <div id="tempGraph" class="graph"></div>
  </div>
  <p class="last-updated" id="last-updated-text"></p>
</div>

  <script>
    // --- ì‚¬ìš©ì ì„¤ì • ---
    // ë³¸ì¸ì˜ GitHub ì €ì¥ì†Œ ì´ë¦„ì„ "ì‚¬ìš©ìëª…/ì €ì¥ì†Œëª…" í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.
    const REPO_NAME = "yeomun/NaCl"; 
    // ------------------

    const DATA_URL = `https://raw.githubusercontent.com/${REPO_NAME}/main/data.json?t=${new Date().getTime()}`;
    const ALERTS_URL = `https://api.github.com/repos/${REPO_NAME}/issues?labels=alert&state=open`;

    async function updateDashboard() {
      try {
        const dataResponse = await fetch(DATA_URL);
        const sensorData = await dataResponse.json();
        
        if (sensorData && sensorData.length > 0) {
          const latestData = sensorData[sensorData.length - 1];
          document.getElementById("time").innerText = latestData.time.split(' ')[1];
          document.getElementById("conc").innerText = latestData.conc.toFixed(3) + "%";
          document.getElementById("temp").innerText = latestData.temp.toFixed(1) + " Â°C";

          const times = sensorData.map(d => d.time);
          const concs = sensorData.map(d => d.conc);
          const temps = sensorData.map(d => d.temp);
          
          Plotly.newPlot("concGraph", [{x: times, y: concs, type: "scatter", mode: "lines+markers", line: { color: "#2196f3" }}], {title: "ë†ë„ ë³€í™”", margin: { t: 40 }});
          Plotly.newPlot("tempGraph", [{x: times, y: temps, type: "scatter", mode: "lines+markers", line: { color: "#e91e63" }}], {title: "ì˜¨ë„ ë³€í™”", margin: { t: 40 }});
        }
      } catch (e) { console.error("ì„¼ì„œ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", e); }

      try {
        const alertsResponse = await fetch(ALERTS_URL);
        const alerts = await alertsResponse.json();
        const alertList = document.getElementById('alert-list');
        
        if (alerts && alerts.length > 0) {
          alertList.innerHTML = '';
          alerts.forEach(issue => {
            const item = document.createElement('li');
            const createdTime = new Date(issue.created_at).toLocaleString('ko-KR');
            item.innerHTML = `<span class="alert-item"><a href="${issue.html_url}" target="_blank">[#${issue.number}] ${issue.title}</a> (ë°œìƒ: ${createdTime})</span>`;
            alertList.appendChild(item);
          });
        } else {
            alertList.innerHTML = '<li>ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        }
      } catch (e) { console.error("ì•Œë¦¼ ë¡œë”© ì‹¤íŒ¨:", e); }

      document.getElementById('last-updated-text').innerText = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
    }

    updateDashboard();
    setInterval(updateDashboard, 60000);
  </script>
</body>

</html>
